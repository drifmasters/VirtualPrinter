

# MyVirtualPrinterPython

**MyVirtualPrinterPython** — проект для создания виртуального принтера в Windows 10/11, который перехватывает задания на печать, анализирует их и выводит информацию о документе (количество страниц, формат и ID задания).
В текущей версии работает в режиме эмуляции: все задания печати сохраняются в XPS-файлы (требуется установленный Microsoft XPS Document Writer).



## Возможности

* Установка виртуального принтера и службы-обработчика через удобный мастер (GUI).
* Перехват каждого задания на печать (все файлы сохраняются в `C:\VM_PRINTERS\VIRT1\`).
* Определение количества страниц, формата бумаги (A4/A3/…), ID задания.
* Окно с кнопками “Удалить” или “Отправить на реальный принтер” для каждого задания.
* **Работает полностью автоматически:** после отправки на печать сразу появляется окно с информацией о документе.
* Поддерживает работу только через XPS-файлы (без подключения к реальному сетевому принтеру).

---

## Как это работает

1. **Виртуальный принтер** создаётся с помощью стандартных средств Windows (PrintUIEntry), в качестве драйвера используется Microsoft XPS Document Writer.
2. При печати задание сохраняется в папку `C:\VM_PRINTERS\VIRT1` в формате XPS.
3. Служба или консольный скрипт автоматически перехватывает новые XPS-файлы и открывает окно с параметрами документа.
4. Можно удалить задание или отправить его на реальный принтер (Microsoft XPS Document Writer).

---

## Установка и запуск

> ⚠️ **Требуются права администратора.**

1. Убедитесь, что в Windows установлен **Microsoft XPS Document Writer** (Панель управления → Программы и компоненты → Включение или отключение компонентов Windows).
2. Склонируйте репозиторий:

   ```
   git clone https://github.com/yourname/MyVirtualPrinterPython.git
   cd MyVirtualPrinterPython
   ```
3. Установите зависимости (через pip, если нужно):

   ```
   pip install pywin32
   ```
4. Запустите установщик виртуального принтера:

   ```
   py setup_virtual_printer.py
   ```
5. После установки скрипт начнёт автоматически отслеживать новые задания в папке XPS.

### Альтернативно — запуск консольного обработчика вручную

```
py printer_worker.py --console
```

(для отладки: можно наблюдать все события прямо в консоли)

---

## Ограничения

* **Работает только с XPS-файлами** (Microsoft XPS Document Writer). Нет поддержки реальных сетевых принтеров — только эмуляция заданий на печать через XPS.
* Имена файлов в папке могут быть одинаковыми, если не настроить уникализацию — рекомендуется очищать папку перед тестами.
* Для полноценной работы с сетевыми принтерами и очередями требуется доработка.

---

## Планы на будущее

* Добавить поддержку реальных сетевых принтеров (через WinAPI).
* Реализовать обработку двухсторонней печати (duplex) и корректный подсчёт физических листов.
* Интеграция с внешними API (например, отправка данных о заданиях на сервер или терминал оплаты).
* Улучшить обработку ошибок и логирование.

---

## Требования

* Windows 10/11
* Python 3.8+
* Библиотеки: `pywin32`, `tkinter` (обычно есть по умолчанию)
* Включённый компонент **Microsoft XPS Document Writer**

---

## Лицензия

MIT

